

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/logo-108-108.png">
  <link rel="icon" href="/logo-108-108.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="陈小可">
  <meta name="keywords" content="开心ucu 技术 学习 笔记">
  
    <meta name="description" content="一些安全厂商的授权信息测试记录，仅供学习使用">
<meta property="og:type" content="article">
<meta property="og:title" content="授权测试记录-虚拟机">
<meta property="og:url" content="http://example.com/2001010/index.html">
<meta property="og:site_name" content="开心ucu">
<meta property="og:description" content="一些安全厂商的授权信息测试记录，仅供学习使用">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-02T08:03:20.000Z">
<meta property="article:modified_time" content="2025-07-27T09:12:12.779Z">
<meta property="article:author" content="陈小可">
<meta property="article:tag" content="记录">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>授权测试记录-虚拟机 - 开心ucu</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":10,"cursorChar":"","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":"25220272a7aa42f5af9faccb45701520","google":{"measurement_id":"G-3YNNRZ9CBE"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?25220272a7aa42f5af9faccb45701520";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-3YNNRZ9CBE", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-3YNNRZ9CBE');
        });
      }
    </script>
  

  

  

  

  



  
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 30vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>开心ucu</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/ANIME-PICTURES.NET_-_817802-1920x1080-elden+ring-gransax-leyndell+soldiers-zeyuz-highres-wide+image-tuya.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="授权测试记录-虚拟机"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-06-02 16:03" pubdate>
          2025年6月2日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">授权测试记录-虚拟机</h1>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>仅供学习使用</p>
<p>本教程仅用于个人学习和技术交流，不构成任何商业推荐或投资建议。教程中涉及的工具、软件或服务仅供参考，作者不对其实际效果、安全性或合法性做任何保证。</p>
<p>请用户根据自身情况审慎判断，并自行承担使用本教程及其中提到的任何工具、软件或服务可能带来的风险（包括但不限于数据丢失、系统损坏、法律纠纷等）。</p>
<p>本教程文字内容由作者[开心ucu]创作，版权归属作者本人。</p>
<p>严禁转载，如果转载造成的任何问题，后果请自行承担</p>
<p>快照是个好东西，建议合理使用，这些镜像等情况都能通过快照形式接着用，无非是有些会掉用ntp或定时同步系统时间<br>实现了授权到期的情况，虚拟机运行时将同步系统时间关闭，不联网（无法连接到ntp服务器）等操作，可实现一直用</p>
</blockquote>
<hr>
<blockquote>
<p>20250727 增加深信服AC，安恒漏扫 内容</p>
</blockquote>
<h1 id="网御星云"><a href="#网御星云" class="headerlink" title="网御星云"></a>网御星云</h1><h2 id="漏扫"><a href="#漏扫" class="headerlink" title="漏扫"></a>漏扫</h2><blockquote>
<p>系统为ova格式，使用Vmware安装，会发现，将此虚拟机换到另一台电脑运行时，授权码会出现变化。</p>
<blockquote>
<p>使用Vmware的cpuID模拟，模拟cpuID和cpu型号可以跳过校验,实现“通用”</p>
</blockquote>
</blockquote>
<p>如果觉得麻烦，直接使用快照即可，关闭Vmware设置的时间同步功能等，做完的时候使用快照，需要用到的时候恢复快照，或挂起。</p>
<h3 id="查看cpuID和型号"><a href="#查看cpuID和型号" class="headerlink" title="查看cpuID和型号"></a>查看cpuID和型号</h3><p>下载一个ubuntu的镜像文件（Desktop），用Try模式，在安装界面这里不安装，打开终端，使用如下命令查看cpu型号(<code>lscpu</code>也能看)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /proc/cpuinfo<br></code></pre></td></tr></table></figure>
<p>返回如下数据</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs text"># cat /proc/cpuinfo <br>processor       : 0<br>vendor_id       : GenuineIntel<br>cpu family      : 6<br>model           : 79<br>model name      : Intel(R) Xeon(R) CPU E5-2660 v4 @ 2.00GHz<br>stepping        : 1<br>microcode       : 0xb00003a<br>cpu MHz         : 1995.500<br>cache size      : 35840 KB<br>physical id     : 0<br>siblings        : 28<br>core id         : 3<br>cpu cores       : 14<br>apicid          : 6<br>initial apicid  : 6<br>fpu             : yes<br>fpu_exception   : yes<br>cpuid level     : 20<br>wp              : yes<br>flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq dtes64 ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch cpuid_fault epb cat_l3 cdp_l3 pti intel_ppin ssbd ibrs ibpb stibp tpr_shadow flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm rdt_a rdseed adx smap intel_pt xsaveopt cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm arat pln pts vnmi md_clear flush_l1d<br>vmx flags       : vnmi preemption_timer posted_intr invvpid ept_x_only ept_ad ept_1gb flexpriority apicv tsc_offset vtpr mtf vapic ept vpid unrestricted_guest vapic_reg vid ple shadow_vmcs pml<br>bugs            : cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa itlb_multihit mmio_stale_data<br>bogomips        : 3991.00<br>clflush size    : 64<br>cache_alignment : 64<br>address sizes   : 46 bits physical, 48 bits virtual<br>power management:<br></code></pre></td></tr></table></figure>
<p>其中cpu型号为model name数据：<code>Intel(R) Xeon(R) CPU E5-2660 v4 @ 2.00GHz</code></p>
<p>查看cpuID如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dmidecode -t 4 | grep ID | sort -u | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;<br></code></pre></td></tr></table></figure>
<p>丰富点的如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dmidecode -t 4 <br></code></pre></td></tr></table></figure>
<p>执行结果如下</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs text">root@hcss-ecs-6975:~#  dmidecode -t 4 <br># dmidecode 3.4<br>Getting SMBIOS data from sysfs.<br>SMBIOS 2.8 present.<br><br>Handle 0x0400, DMI type 4, 42 bytes<br>Processor Information<br>        Socket Designation: CPU 0<br>        Type: Central Processor<br>        Family: Other<br>        Manufacturer: QEMU<br>        ID: 57 06 05 00 FF FB 8B 0F<br>        Version: pc-i440fx-2.8<br>        Voltage: Unknown<br>        External Clock: Unknown<br>        Max Speed: 2000 MHz<br>        Current Speed: 2000 MHz<br>        Status: Populated, Enabled<br>        Upgrade: Other<br>        L1 Cache Handle: Not Provided<br>        L2 Cache Handle: Not Provided<br>        L3 Cache Handle: Not Provided<br>        Serial Number: Not Specified<br>        Asset Tag: Not Specified<br>        Part Number: Not Specified<br>        Core Count: 1<br>        Core Enabled: 1<br>        Thread Count: 2<br>        Characteristics: None<br><br>root@hcss-ecs-6975:~# <br></code></pre></td></tr></table></figure>
<p>其中cpuID为<code>57 06 05 00 FF FB 8B 0F</code></p>
<p>修改vmware的信息参考这个地址：<a target="_blank" rel="noopener" href="https://luotianyi.vc/8375.html">https://luotianyi.vc/8375.html</a></p>
<h3 id="进底层"><a href="#进底层" class="headerlink" title="进底层"></a>进底层</h3><p>有个挑战码，这个可以直接拨打400拿到进底层</p>
<blockquote>
<p>我找到个0day，可以通过这个0day直接进底层，暂不公开</p>
</blockquote>
<h3 id="授权时间"><a href="#授权时间" class="headerlink" title="授权时间"></a>授权时间</h3><p>经测试，过去后，修改时间为授权时间范围内，可以正常使用</p>
<blockquote>
<p>进底层，将ntp相关服务删了，同时更改系统时间为授权时间范围</p>
<p>然后呢，基线等正常，包括xxx都正常的</p>
</blockquote>
<h2 id="EDR"><a href="#EDR" class="headerlink" title="EDR"></a>EDR</h2><h3 id="安装，使用openEuler进行安装"><a href="#安装，使用openEuler进行安装" class="headerlink" title="安装，使用openEuler进行安装"></a>安装，使用openEuler进行安装</h3><p>安装过程中，可以通过ps -aux查看进程得到***的密码<br>解包后可进行内容分析</p>
<p>当然了，EDR装好后也可以直接登录系统openEuler看的。</p>
<p>能够定位到使用了tomcat，且调用了war包，通过逆向war包，测试，能够拿到xxx的逻辑</p>
<p>其中，java中调用了so文件来解密授权文件，逆向so文件（C#）按照这个逻辑，弄到授权的加密逻辑，可根据逻辑编写加密及解密的方法实现自己开授权</p>
<p>经测试xx后正常，且xx等都能实现。</p>
<h1 id="安恒信息"><a href="#安恒信息" class="headerlink" title="安恒信息"></a>安恒信息</h1><h2 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h2><h3 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h3><h3 id="改Vmware模拟cpuid等"><a href="#改Vmware模拟cpuid等" class="headerlink" title="改Vmware模拟cpuid等"></a>改Vmware模拟cpuid等</h3><p>和网御星云的楼扫一样，实际上嘛，用不用这个方法无所谓，多的不好描述</p>
<h3 id="部分授权信息"><a href="#部分授权信息" class="headerlink" title="部分授权信息"></a>部分授权信息</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;number&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xxxxxxXXxx&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;serviceCode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xxxxxxxxxxxxxxxxxxxx&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;licenseStartDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xxxx-xx-xx 00:00:00&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;licenseMainDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xxxx-xx-xx 00:00:00&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;licenseSubject&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xxxx&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;licenseVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;正式版&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;licenseEndDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xxxx-xx-xx 00:00:00&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;modules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;task_concurrent_num&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;任务授权信息&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;任务并发数&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;option&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;webscan&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;网站扫描&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;授权数&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;无限制&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dbscan&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;数据库扫描&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;授权数&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;无限制&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hostscan&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;主机扫描&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;授权数&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;无限制&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;baseline&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;基线扫描&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;授权数&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;无限制&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>
<h3 id="部分代码"><a href="#部分代码" class="headerlink" title="部分代码"></a>部分代码</h3><p>部分授权信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XXXX</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_START_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_START_TIME&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_END_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_END_TIME&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_MAIN_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_MAIN_TIME&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_USER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_USER&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_PRODUCT_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_PRODUCT_CODE&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_VERSION</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_VERSION&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SYS_MODELS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SYS_MODELS&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MODELS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;MODELS&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">RUNTIME_ENV_OS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;OS&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">RUNTIME_ENV_RAM</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RAM&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">RUNTIME_ENV_HWADDR</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;HWADDR&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_OK</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_FILE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">32</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_TIME_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">64</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_RENV_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">128</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_CODE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">256</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_OTHER_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">512</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_FILE_NOT_EXIST</span> <span class="hljs-operator">=</span> <span class="hljs-number">33</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_FILE_ERR_FORMAT</span> <span class="hljs-operator">=</span> <span class="hljs-number">34</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_TIME_AHEAD_START</span> <span class="hljs-operator">=</span> <span class="hljs-number">65</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_TIME_EXCEED_MAIN</span> <span class="hljs-operator">=</span> <span class="hljs-number">66</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_TIME_EXCEED_END</span> <span class="hljs-operator">=</span> <span class="hljs-number">67</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_RENV_RAM</span> <span class="hljs-operator">=</span> <span class="hljs-number">129</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_RENV_OS</span> <span class="hljs-operator">=</span> <span class="hljs-number">130</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">L_RENV_HWADDR</span> <span class="hljs-operator">=</span> <span class="hljs-number">131</span>;<br>   <span class="hljs-keyword">protected</span> <span class="hljs-type">Map</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>();<br>   <span class="hljs-keyword">private</span> _L.StringCryption stringCryption;<br>   <span class="hljs-keyword">private</span> _L.StringIO stringIO;<br>   <span class="hljs-keyword">private</span> _L.StringConverter stringConverter;<br><br>   <span class="hljs-keyword">protected</span> Map <span class="hljs-title function_">getRuntimeEnv</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">renv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>();<br>      <span class="hljs-type">String</span> <span class="hljs-variable">default_value</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ERROR&quot;</span>;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">ram</span> <span class="hljs-operator">=</span> default_value;<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         ram = SIGather.getRamMB() + <span class="hljs-string">&quot;MB&quot;</span>;<br>      &#125; <span class="hljs-keyword">catch</span> (Throwable var8) &#123;<br>         var8.printStackTrace();<br>      &#125;<br><br>      renv.put(<span class="hljs-string">&quot;RAM&quot;</span>, ram);<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      os.put(<span class="hljs-string">&quot;os.name&quot;</span>, SIGather.getOSName());<br>      os.put(<span class="hljs-string">&quot;os.version&quot;</span>, SIGather.getOSVersion());<br>      os.put(<span class="hljs-string">&quot;os.arch&quot;</span>, SIGather.getOSArch());<br>      renv.put(<span class="hljs-string">&quot;OS&quot;</span>, os);<br>      <span class="hljs-type">String</span> <span class="hljs-variable">hwaddr</span> <span class="hljs-operator">=</span> default_value;<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         hwaddr = SIGather.getMAC();<br>      &#125; <span class="hljs-keyword">catch</span> (Throwable var7) &#123;<br>         var7.printStackTrace();<br>      &#125;<br><br>      renv.put(<span class="hljs-string">&quot;HWADDR&quot;</span>, hwaddr);<br>      <span class="hljs-keyword">return</span> renv;<br>   &#125;<br><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String msg, Exception e)</span> &#123;<br>      <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; !msg.isEmpty()) &#123;<br>         System.err.println(msg);<br>      &#125;<br><br>      <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>         e.printStackTrace(System.err);<br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> _L.StringIO <span class="hljs-title function_">getStringIO</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> (_L.StringIO)(<span class="hljs-built_in">this</span>.stringIO == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">_L</span>.DefaultStringIO() : <span class="hljs-built_in">this</span>.stringIO);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStringIO</span><span class="hljs-params">(_L.StringIO stringIO)</span> &#123;<br>      <span class="hljs-built_in">this</span>.stringIO = stringIO;<br>   &#125;<br><br>   _L.StringConverter <span class="hljs-title function_">getStringConverter</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.stringConverter;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStringConverter</span><span class="hljs-params">(_L.StringConverter stringConverter)</span> &#123;<br>      <span class="hljs-built_in">this</span>.stringConverter = stringConverter;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> _L.StringCryption <span class="hljs-title function_">getStringCryption</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> (_L.StringCryption)(<span class="hljs-built_in">this</span>.stringCryption == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">_L</span>.DefaultStringCryption() : <span class="hljs-built_in">this</span>.stringCryption);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStringCryption</span><span class="hljs-params">(_L.StringCryption stringCryption)</span> &#123;<br>      <span class="hljs-built_in">this</span>.stringCryption = stringCryption;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultStringIO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">_L</span>.StringIO &#123;<br>      <span class="hljs-keyword">private</span> <span class="hljs-title function_">DefaultStringIO</span><span class="hljs-params">()</span> &#123;<br>      &#125;<br><br>      <span class="hljs-keyword">public</span> String <span class="hljs-title function_">read</span><span class="hljs-params">(InputStream inputStream)</span> &#123;<br>         <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>         <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4096</span>];<br>         <span class="hljs-type">boolean</span> <span class="hljs-variable">var4</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>         <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">int</span> k;<br>            <span class="hljs-keyword">while</span>((k = inputStream.read(buffer)) &gt; <span class="hljs-number">0</span>) &#123;<br>               byteArrayOutputStream.write(buffer, <span class="hljs-number">0</span>, k);<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(byteArrayOutputStream.toByteArray());<br>         &#125; <span class="hljs-keyword">catch</span> (IOException var6) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(var6);<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wirte</span><span class="hljs-params">(OutputStream outputStream, String content)</span> &#123;<br>         <span class="hljs-type">byte</span>[] bytes = content.getBytes();<br><br>         <span class="hljs-keyword">try</span> &#123;<br>            outputStream.write(bytes);<br>            outputStream.flush();<br>         &#125; <span class="hljs-keyword">catch</span> (IOException var5) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(var5);<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-comment">// $FF: synthetic method</span><br>      DefaultStringIO(Object x1) &#123;<br>         <span class="hljs-built_in">this</span>();<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultStringCryption</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">_L</span>.StringCryption &#123;<br>      <span class="hljs-keyword">private</span> String key;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-title function_">DefaultStringCryption</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-built_in">this</span>.key = <span class="hljs-string">&quot;XXXXXXXXXXXX&quot;</span>;<br>      &#125;<br><br>      <span class="hljs-keyword">public</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String source)</span> &#123;<br>         <span class="hljs-keyword">if</span> (source != <span class="hljs-literal">null</span> &amp;&amp; !source.trim().isEmpty()) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-type">byte</span>[] bytes = source.getBytes(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>               <span class="hljs-type">byte</span>[] bytes1 = <span class="hljs-built_in">this</span>.encryByRC4(bytes, <span class="hljs-built_in">this</span>.key);<br>               <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.Bytes2HexString(bytes1);<br>            &#125; <span class="hljs-keyword">catch</span> (UnsupportedEncodingException var4) &#123;<br>               <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(var4);<br>            &#125;<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> source;<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">public</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String source)</span> &#123;<br>         <span class="hljs-keyword">if</span> (source != <span class="hljs-literal">null</span> &amp;&amp; !source.trim().isEmpty()) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-type">byte</span>[] bytes = <span class="hljs-built_in">this</span>.HexString2Bytes(source);<br>               <span class="hljs-type">byte</span>[] bytes1 = <span class="hljs-built_in">this</span>.decryByRC4(bytes, <span class="hljs-built_in">this</span>.key);<br>               <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes1, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (UnsupportedEncodingException var4) &#123;<br>               <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(var4);<br>            &#125;<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> source;<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] decryByRC4(<span class="hljs-type">byte</span>[] data, String key) &#123;<br>         <span class="hljs-keyword">return</span> data != <span class="hljs-literal">null</span> &amp;&amp; key != <span class="hljs-literal">null</span> ? <span class="hljs-built_in">this</span>.RC4Base(data, key) : <span class="hljs-literal">null</span>;<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] encryByRC4(<span class="hljs-type">byte</span>[] data, String key) &#123;<br>         <span class="hljs-keyword">return</span> data != <span class="hljs-literal">null</span> &amp;&amp; key != <span class="hljs-literal">null</span> ? <span class="hljs-built_in">this</span>.RC4Base(data, key) : <span class="hljs-literal">null</span>;<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> String <span class="hljs-title function_">asString</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] buf)</span> &#123;<br>         <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">strbuf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>(buf.length);<br><br>         <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; buf.length; ++i) &#123;<br>            strbuf.append((<span class="hljs-type">char</span>)buf[i]);<br>         &#125;<br><br>         <span class="hljs-keyword">return</span> strbuf.toString();<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] initKey(String aKey) &#123;<br>         <span class="hljs-type">byte</span>[] b_key = aKey.getBytes();<br>         <span class="hljs-type">byte</span>[] state = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">256</span>];<br><br>         <span class="hljs-type">int</span> index1;<br>         <span class="hljs-keyword">for</span>(index1 = <span class="hljs-number">0</span>; index1 &lt; <span class="hljs-number">256</span>; ++index1) &#123;<br>            state[index1] = (<span class="hljs-type">byte</span>)index1;<br>         &#125;<br><br>         index1 = <span class="hljs-number">0</span>;<br>         <span class="hljs-type">int</span> <span class="hljs-variable">index2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>         <span class="hljs-keyword">if</span> (b_key != <span class="hljs-literal">null</span> &amp;&amp; b_key.length != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; ++i) &#123;<br>               index2 = (b_key[index1] &amp; <span class="hljs-number">255</span>) + (state[i] &amp; <span class="hljs-number">255</span>) + index2 &amp; <span class="hljs-number">255</span>;<br>               <span class="hljs-type">byte</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> state[i];<br>               state[i] = state[index2];<br>               state[index2] = tmp;<br>               index1 = (index1 + <span class="hljs-number">1</span>) % b_key.length;<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> state;<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> String <span class="hljs-title function_">Bytes2HexString</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data)</span> &#123;<br>         <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.asString(data);<br>         <span class="hljs-type">int</span> <span class="hljs-variable">sLen</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)Math.ceil((<span class="hljs-type">double</span>)s.length() / <span class="hljs-number">2.0D</span>);<br>         <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>         <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br><br>         <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; sLen; ++i) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> s.charAt(i);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">s4</span> <span class="hljs-operator">=</span> Integer.toHexString(ch &amp; <span class="hljs-number">255</span>);<br>            <span class="hljs-keyword">if</span> (s4.length() == <span class="hljs-number">1</span>) &#123;<br>               str.append(<span class="hljs-string">&#x27;0&#x27;</span>);<br>            &#125;<br><br>            str.append(s4);<br>            <span class="hljs-keyword">if</span> (sLen + i &lt; s.length()) &#123;<br>               <span class="hljs-type">int</span> <span class="hljs-variable">ch1</span> <span class="hljs-operator">=</span> s.charAt(sLen + i);<br>               <span class="hljs-type">String</span> <span class="hljs-variable">s44</span> <span class="hljs-operator">=</span> Integer.toHexString(ch1 &amp; <span class="hljs-number">255</span>);<br>               <span class="hljs-keyword">if</span> (s44.length() == <span class="hljs-number">1</span>) &#123;<br>                  str1.append(<span class="hljs-string">&#x27;0&#x27;</span>);<br>               &#125;<br><br>               str1.append(s44);<br>            &#125;<br>         &#125;<br><br>         <span class="hljs-keyword">return</span> str.append(str1).toString();<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] HexString2Bytes(String src) &#123;<br>         <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> src.length();<br>         <span class="hljs-type">byte</span>[] ret = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[size / <span class="hljs-number">2</span>];<br>         <span class="hljs-type">byte</span>[] tmp = src.getBytes();<br><br>         <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size / <span class="hljs-number">2</span>; ++i) &#123;<br>            ret[i] = <span class="hljs-built_in">this</span>.uniteBytes(tmp[i * <span class="hljs-number">2</span>], tmp[i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>]);<br>         &#125;<br><br>         <span class="hljs-keyword">return</span> ret;<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span> <span class="hljs-title function_">uniteBytes</span><span class="hljs-params">(<span class="hljs-type">byte</span> src0, <span class="hljs-type">byte</span> src1)</span> &#123;<br>         <span class="hljs-type">char</span> <span class="hljs-variable">_b0</span> <span class="hljs-operator">=</span> (<span class="hljs-type">char</span>)Byte.decode(<span class="hljs-string">&quot;0x&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;src0&#125;));<br>         _b0 = (<span class="hljs-type">char</span>)(_b0 &lt;&lt; <span class="hljs-number">4</span>);<br>         <span class="hljs-type">char</span> <span class="hljs-variable">_b1</span> <span class="hljs-operator">=</span> (<span class="hljs-type">char</span>)Byte.decode(<span class="hljs-string">&quot;0x&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;src1&#125;));<br>         <span class="hljs-type">byte</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> (<span class="hljs-type">byte</span>)(_b0 ^ _b1);<br>         <span class="hljs-keyword">return</span> ret;<br>      &#125;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] RC4Base(<span class="hljs-type">byte</span>[] input, String mKkey) &#123;<br>         <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>         <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>         <span class="hljs-type">byte</span>[] key = <span class="hljs-built_in">this</span>.initKey(mKkey);<br>         <span class="hljs-type">byte</span>[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[input.length];<br><br>         <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; input.length; ++i) &#123;<br>            x = x + <span class="hljs-number">1</span> &amp; <span class="hljs-number">255</span>;<br>            y = (key[x] &amp; <span class="hljs-number">255</span>) + y &amp; <span class="hljs-number">255</span>;<br>            <span class="hljs-type">byte</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> key[x];<br>            key[x] = key[y];<br>            key[y] = tmp;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">xorIndex</span> <span class="hljs-operator">=</span> (key[x] &amp; <span class="hljs-number">255</span>) + (key[y] &amp; <span class="hljs-number">255</span>) &amp; <span class="hljs-number">255</span>;<br>            result[i] = (<span class="hljs-type">byte</span>)(input[i] ^ key[xorIndex]);<br>         &#125;<br><br>         <span class="hljs-keyword">return</span> result;<br>      &#125;<br><br>      <span class="hljs-comment">// $FF: synthetic method</span><br>      DefaultStringCryption(Object x1) &#123;<br>         <span class="hljs-built_in">this</span>();<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StringConverter</span> &#123;<br>      String <span class="hljs-title function_">toString</span><span class="hljs-params">(Object var1)</span>;<br><br>      Object <span class="hljs-title function_">fromString</span><span class="hljs-params">(String var1, Class var2)</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StringIO</span> &#123;<br>      String <span class="hljs-title function_">read</span><span class="hljs-params">(InputStream var1)</span>;<br><br>      <span class="hljs-keyword">void</span> <span class="hljs-title function_">wirte</span><span class="hljs-params">(OutputStream var1, String var2)</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StringCryption</span> &#123;<br>      String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String var1)</span>;<br><br>      String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String var1)</span>;<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>部分网络请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;&#125;)</span><br><span class="hljs-meta">@Guarded</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthAction</span> &#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LogManager.getLogger(AuthAction.class);<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> LoadingCache verificationCodeMap;<br>   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> IUser userService;<br>   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> ILog logService;<br>   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">public</span> RedisTemplate redisTemplate;<br>   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">public</span> IUpgrade upgradeService;<br>   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">public</span> IRole roleService;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IPADDR_LOCK</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ipaddrLock&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">USER_ATTRIBUTE_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user&quot;</span>;<br><br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;settings&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">setting</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-keyword">return</span> ProductUtil.isSecret() ? <span class="hljs-built_in">this</span>.setting_secret(request) : <span class="hljs-built_in">this</span>.setting_default();<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">setting_default</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">JsonObj</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">settings</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">licInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         licInfo = (Map)LicenseUIData.readInfo().get(<span class="hljs-string">&quot;license&quot;</span>);<br>      &#125; <span class="hljs-keyword">catch</span> (Exception var8) &#123;<br>         log.error(<span class="hljs-string">&quot;read license error&quot;</span>, var8);<br>      &#125;<br><br>      <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>      version.append(CurrentLocale.getMessage(<span class="hljs-string">&quot;auth.get.normal.msg1-1&quot;</span>, MapUtils.getString((Map)licInfo, <span class="hljs-string">&quot;licenseSubject&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>)));<br>      <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">version2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>      <span class="hljs-keyword">if</span> (ProductUtil.isSecret()) &#123;<br>         <span class="hljs-type">String</span> <span class="hljs-variable">licenseVersion</span> <span class="hljs-operator">=</span> org.apache.commons.collections4.MapUtils.getString(Constant.CONF, <span class="hljs-string">&quot;license_version&quot;</span>);<br>         <span class="hljs-keyword">if</span> (!Strings.isNullOrEmpty(licenseVersion)) &#123;<br>            version2.append(licenseVersion);<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            version2.append(MapUtils.getString((Map)licInfo, <span class="hljs-string">&quot;licenseVersion&quot;</span>, <span class="hljs-string">&quot;正式版&quot;</span>));<br>         &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         version.append(MapUtils.getString((Map)licInfo, <span class="hljs-string">&quot;licenseVersion&quot;</span>, <span class="hljs-string">&quot;正式版&quot;</span>));<br>         version.append(<span class="hljs-string">&quot; v&quot;</span>);<br>      &#125;<br><br>      <span class="hljs-type">Map</span> <span class="hljs-variable">others</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      settings.put(<span class="hljs-string">&quot;logo&quot;</span>, <span class="hljs-string">&quot;/logo/logo-cra.png&quot;</span>);<br>      version.append(UpgradeHelper.currentVersion());<br>      others.put(<span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>      settings.put(<span class="hljs-string">&quot;version&quot;</span>, version.toString());<br>      settings.put(<span class="hljs-string">&quot;copyright&quot;</span>, Constant.CONF.getProperty(<span class="hljs-string">&quot;product_copyright&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;supportUrl&quot;</span>, Constant.CONF.getProperty(<span class="hljs-string">&quot;company_website&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;contact&quot;</span>, Constant.CONF.getProperty(<span class="hljs-string">&quot;produc_contact&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;encrypt&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>      settings.put(<span class="hljs-string">&quot;login&quot;</span>, <span class="hljs-literal">true</span>);<br>      String productName;<br>      <span class="hljs-keyword">if</span> (ProductUtil.isSecret()) &#123;<br>         productName = SysConfig.INFO.get(<span class="hljs-string">&quot;product_name&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_name_secret&quot;</span>));<br>         <span class="hljs-keyword">if</span> (Strings.isNullOrEmpty(productName)) &#123;<br>            productName = CurrentLocale.getMessage(Constant.CONF.getProperty(<span class="hljs-string">&quot;product_name_scan&quot;</span>));<br>            settings.put(<span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-literal">true</span>);<br>            settings.put(<span class="hljs-string">&quot;series&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_series&quot;</span>));<br>            settings.put(<span class="hljs-string">&quot;support&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_company&quot;</span>));<br>            settings.put(<span class="hljs-string">&quot;holder&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_series&quot;</span>));<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            settings.put(<span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-literal">false</span>);<br>            settings.put(<span class="hljs-string">&quot;series&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>            settings.put(<span class="hljs-string">&quot;support&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_company&quot;</span>));<br>            settings.put(<span class="hljs-string">&quot;holder&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>         &#125;<br><br>         settings.put(<span class="hljs-string">&quot;title&quot;</span>, productName + <span class="hljs-string">&quot; &quot;</span> + version2.toString());<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         productName = SysConfig.INFO.get(<span class="hljs-string">&quot;product_name&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>         <span class="hljs-keyword">if</span> (Strings.isNullOrEmpty(productName) &amp;&amp; !ProductUtil.isSecret()) &#123;<br>            productName = CurrentLocale.getMessage(Constant.CONF.getProperty(<span class="hljs-string">&quot;product_name_scan&quot;</span>));<br>            settings.put(<span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-literal">false</span>);<br>            settings.put(<span class="hljs-string">&quot;series&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>            settings.put(<span class="hljs-string">&quot;support&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_company&quot;</span>));<br>            settings.put(<span class="hljs-string">&quot;holder&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            settings.put(<span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-literal">false</span>);<br>            settings.put(<span class="hljs-string">&quot;series&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>            settings.put(<span class="hljs-string">&quot;support&quot;</span>, SysConfig.INFO.get(<span class="hljs-string">&quot;product_company&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_company&quot;</span>)));<br>            settings.put(<span class="hljs-string">&quot;holder&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>         &#125;<br><br>         settings.put(<span class="hljs-string">&quot;title&quot;</span>, productName);<br>      &#125;<br><br>      others.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;form&quot;</span>);<br>      others.put(<span class="hljs-string">&quot;link&quot;</span>, <span class="hljs-literal">false</span>);<br>      others.put(<span class="hljs-string">&quot;slogan&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>      others.put(<span class="hljs-string">&quot;forgot_pass&quot;</span>, <span class="hljs-literal">false</span>);<br>      others.put(<span class="hljs-string">&quot;signup&quot;</span>, <span class="hljs-literal">false</span>);<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      auth.put(<span class="hljs-string">&quot;admin&quot;</span>, others);<br>      settings.put(<span class="hljs-string">&quot;auth&quot;</span>, auth);<br>      settings.put(<span class="hljs-string">&quot;product_type&quot;</span>, SysConfig.INFO.getAsInt(<span class="hljs-string">&quot;system_type&quot;</span>, <span class="hljs-number">1</span>));<br>      settings.put(<span class="hljs-string">&quot;lang&quot;</span>, CurrentLocale.getLocale().toLanguageTag());<br>      obj.put(<span class="hljs-string">&quot;setting&quot;</span>, settings);<br>      <span class="hljs-keyword">return</span> obj;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">setting_secret</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>      <span class="hljs-type">JsonObj</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">settings</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">licInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         licInfo = (Map)LicenseUIData.readInfo().get(<span class="hljs-string">&quot;license&quot;</span>);<br>      &#125; <span class="hljs-keyword">catch</span> (Exception var11) &#123;<br>         log.error(<span class="hljs-string">&quot;read license error&quot;</span>, var11);<br>      &#125;<br><br>      <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>      version.append(CurrentLocale.getMessage(<span class="hljs-string">&quot;auth.get.normal.msg1-1&quot;</span>, MapUtils.getString((Map)licInfo, <span class="hljs-string">&quot;licenseSubject&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>)));<br>      <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">version2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>      <span class="hljs-type">String</span> <span class="hljs-variable">licenseVersion</span> <span class="hljs-operator">=</span> org.apache.commons.collections4.MapUtils.getString(Constant.CONF, <span class="hljs-string">&quot;license_version&quot;</span>);<br>      <span class="hljs-keyword">if</span> (!Strings.isNullOrEmpty(licenseVersion)) &#123;<br>         version2.append(licenseVersion);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         version2.append(MapUtils.getString((Map)licInfo, <span class="hljs-string">&quot;licenseVersion&quot;</span>, <span class="hljs-string">&quot;正式版&quot;</span>));<br>      &#125;<br><br>      version2.append(<span class="hljs-string">&quot; V&quot;</span>);<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">others</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      settings.put(<span class="hljs-string">&quot;logo&quot;</span>, <span class="hljs-string">&quot;/logo/logo-cra.png&quot;</span>);<br>      version2.append(Constant.CONF.getProperty(<span class="hljs-string">&quot;product_version&quot;</span>));<br>      others.put(<span class="hljs-string">&quot;title&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;auth.get.normal.msg1-2&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;version&quot;</span>, version.toString());<br>      settings.put(<span class="hljs-string">&quot;copyright&quot;</span>, Constant.CONF.getProperty(<span class="hljs-string">&quot;product_copyright&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;supportUrl&quot;</span>, Constant.CONF.getProperty(<span class="hljs-string">&quot;company_website&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;contact&quot;</span>, Constant.CONF.getProperty(<span class="hljs-string">&quot;produc_contact&quot;</span>));<br>      settings.put(<span class="hljs-string">&quot;encrypt&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>      settings.put(<span class="hljs-string">&quot;login&quot;</span>, <span class="hljs-literal">true</span>);<br>      <span class="hljs-type">String</span> <span class="hljs-variable">productName</span> <span class="hljs-operator">=</span> SysConfig.INFO.get(<span class="hljs-string">&quot;product_name&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_name_secret&quot;</span>));<br>      <span class="hljs-keyword">if</span> (Strings.isNullOrEmpty(productName)) &#123;<br>         productName = CurrentLocale.getMessage(<span class="hljs-string">&quot;product_name_secret&quot;</span>);<br>         settings.put(<span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-literal">true</span>);<br>         settings.put(<span class="hljs-string">&quot;series&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_series&quot;</span>));<br>         settings.put(<span class="hljs-string">&quot;support&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_company&quot;</span>));<br>         settings.put(<span class="hljs-string">&quot;holder&quot;</span>, CurrentLocale.getMessage(<span class="hljs-string">&quot;product_series&quot;</span>));<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         settings.put(<span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-literal">false</span>);<br>         settings.put(<span class="hljs-string">&quot;series&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>         settings.put(<span class="hljs-string">&quot;support&quot;</span>, SysConfig.INFO.get(<span class="hljs-string">&quot;product_company&quot;</span>, <span class="hljs-string">&quot;&quot;</span>));<br>         settings.put(<span class="hljs-string">&quot;holder&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>      &#125;<br><br>      settings.put(<span class="hljs-string">&quot;title&quot;</span>, productName + <span class="hljs-string">&quot; &quot;</span> + version2.toString());<br>      others.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;form&quot;</span>);<br>      others.put(<span class="hljs-string">&quot;link&quot;</span>, <span class="hljs-literal">false</span>);<br>      others.put(<span class="hljs-string">&quot;slogan&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>      others.put(<span class="hljs-string">&quot;forgot_pass&quot;</span>, <span class="hljs-literal">false</span>);<br>      others.put(<span class="hljs-string">&quot;signup&quot;</span>, <span class="hljs-literal">false</span>);<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      auth.put(<span class="hljs-string">&quot;admin&quot;</span>, others);<br>      settings.put(<span class="hljs-string">&quot;auth&quot;</span>, auth);<br>      settings.put(<span class="hljs-string">&quot;product_type&quot;</span>, SysConfig.INFO.getAsInt(<span class="hljs-string">&quot;system_type&quot;</span>, <span class="hljs-number">1</span>));<br>      settings.put(<span class="hljs-string">&quot;lang&quot;</span>, CurrentLocale.getLocale().toLanguageTag());<br>      obj.put(<span class="hljs-string">&quot;setting&quot;</span>, settings);<br>      <span class="hljs-keyword">return</span> obj;<br>   &#125;<br><br>   <span class="hljs-meta">@IgnoreTokenRestful</span><br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;config&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">config</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">configMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>      <span class="hljs-type">JsonObj</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>      obj.appendData(configMap);<br>      configMap.put(<span class="hljs-string">&quot;monitor&quot;</span>, <span class="hljs-literal">true</span>);<br>      configMap.put(<span class="hljs-string">&quot;http401&quot;</span>, <span class="hljs-literal">true</span>);<br>      configMap.put(<span class="hljs-string">&quot;http502&quot;</span>, <span class="hljs-literal">true</span>);<br>      configMap.put(<span class="hljs-string">&quot;monitor_time&quot;</span>, <span class="hljs-number">1000</span>);<br>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isCasLoginModel()) &#123;<br>         configMap.put(<span class="hljs-string">&quot;monitor&quot;</span>, <span class="hljs-literal">true</span>);<br>         configMap.put(<span class="hljs-string">&quot;http401&quot;</span>, <span class="hljs-literal">false</span>);<br>         configMap.put(<span class="hljs-string">&quot;http502&quot;</span>, <span class="hljs-literal">false</span>);<br>         configMap.put(<span class="hljs-string">&quot;monitor_time&quot;</span>, <span class="hljs-number">10000</span>);<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> obj;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCasLoginModel</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> CasModelManager.isCasModel();<br>   &#125;<br><br>   <span class="hljs-meta">@BaseLineAssetAdapterAdvisor</span>.BaseLineLimit<br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;profile&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">profile</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Integer)IdentitySupplier.userIdFromRequest.supplyWith(request);<br>      <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (User)<span class="hljs-built_in">this</span>.userService.queryById(userId);<br>      Validate.notNull(u, <span class="hljs-string">&quot;user.login.error.notExist&quot;</span>);<br>      <span class="hljs-type">JsonObj</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>      obj.put(<span class="hljs-string">&quot;name&quot;</span>, u.getUsername());<br>      obj.put(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-built_in">this</span>.userService.queryRole(userId).getName());<br>      obj.put(<span class="hljs-string">&quot;avatar&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>      <span class="hljs-keyword">return</span> obj;<br>   &#125;<br><br>   <span class="hljs-meta">@PostConstruct</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>      UserSessionManagerFactory.getInstance().registerSessionCallback((sid, e) -&gt; &#123;<br>         <span class="hljs-keyword">switch</span>(e) &#123;<br>         <span class="hljs-keyword">case</span> expiration:<br>            <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-type">Integer</span> <span class="hljs-variable">uid</span> <span class="hljs-operator">=</span> (Integer)IdentitySupplier.userIdFromSessionId.supplyWith(sid);<br>               <span class="hljs-type">UserService</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> (UserService)SpringContext.getBean(UserService.class);<br>               <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (User)bean.queryById(uid);<br>               LogAdder.add(u.getUsername(), u.getId(), (String)<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;access.log.system.event.65&quot;</span>, <span class="hljs-string">&quot;access.log.system.desct.65&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">3</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception var5) &#123;<br>            &#125;<br>         <span class="hljs-keyword">default</span>:<br>         &#125;<br>      &#125;);<br>   &#125;<br><br>   <span class="hljs-meta">@IgnoreTokenRestful</span><br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;auth/tokens&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.POST&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postTokens</span><span class="hljs-params">(HttpServletRequest req, <span class="hljs-meta">@RequestHeader</span> String times, <span class="hljs-meta">@RequestHeader</span> String hash, String username, String password, String captcha, Integer type, String dynamic)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">product_type</span> <span class="hljs-operator">=</span> SysConfig.INFO.getAsInt(<span class="hljs-string">&quot;system_type&quot;</span>, <span class="hljs-number">1</span>);<br>      SYSTEMTYPE systemtype;<br>      <span class="hljs-keyword">if</span> (type == <span class="hljs-literal">null</span>) &#123;<br>         systemtype = SYSTEMTYPE.valueOf(product_type);<br>         <span class="hljs-keyword">switch</span>(systemtype) &#123;<br>         <span class="hljs-keyword">case</span> DEFAULT:<br>         <span class="hljs-keyword">case</span> SECRET:<br>            type = LOGIN.TRADITION.getValue();<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> FACTOR:<br>            type = LOGIN.TWOFACTOR.getValue();<br>         &#125;<br>      &#125;<br><br>      systemtype = <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">LOGIN</span> <span class="hljs-variable">login</span> <span class="hljs-operator">=</span> LOGIN.fromByValue(type);<br>      Object o;<br>      <span class="hljs-keyword">switch</span>(login) &#123;<br>      <span class="hljs-keyword">case</span> TRADITION:<br>         o = <span class="hljs-built_in">this</span>.loginByTradition(req, times, hash, username, password, captcha);<br>         <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> TWOFACTOR:<br>         o = <span class="hljs-built_in">this</span>.loginByTwoFactor(req, username, password, dynamic, times, hash);<br>         <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.error.unknownLogin&quot;</span>, <span class="hljs-string">&quot;user.login.error.unknownLogin&quot;</span>);<br>      &#125;<br><br>      req.getSession().invalidate();<br>      <span class="hljs-keyword">if</span> (ArrayUtils.isNotEmpty(req.getCookies())) &#123;<br>         <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> req.getCookies()[<span class="hljs-number">0</span>];<br>         cookie.setMaxAge(<span class="hljs-number">0</span>);<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> o;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">loginByTradition</span><span class="hljs-params">(HttpServletRequest req, String times, String hash, String username, String password, String captcha)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">logEvent</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;access.log.system.55.event&quot;</span>;<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">boolean</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT.getAsInt(SysSetAction.SetItem.verification_code.name(), <span class="hljs-number">1</span>) == <span class="hljs-number">1</span>;<br>         <span class="hljs-keyword">if</span> (!code || !((String)verificationCodeMap.get(hash)).equals(<span class="hljs-string">&quot;&quot;</span>) &amp;&amp; captcha.toLowerCase().equals(((String)verificationCodeMap.get(hash)).toLowerCase())) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.logining(req, username, password, times, hash, logEvent, <span class="hljs-string">&quot;access.log.system.55.desct&quot;</span>);<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            verificationCodeMap.invalidate(hash);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.warn.codeError&quot;</span>);<br>         &#125;<br>      &#125; <span class="hljs-keyword">catch</span> (Exception var14) &#123;<br>         <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;access.log.system.56.desct&quot;</span>;<br>         <span class="hljs-keyword">if</span> (var14 <span class="hljs-keyword">instanceof</span> AppException) &#123;<br>            msg = var14.getMessage();<br>            <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>            Object[] params = ((AppException)var14).getParams();<br>            <span class="hljs-keyword">if</span> (params != <span class="hljs-literal">null</span> &amp;&amp; params.length &gt; <span class="hljs-number">0</span>) &#123;<br>               msg = msg + <span class="hljs-string">&quot;____&quot;</span>;<br><br>               <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; params.length; ++i) &#123;<br>                  <span class="hljs-type">Object</span> <span class="hljs-variable">ob</span> <span class="hljs-operator">=</span> params[i];<br>                  sb.append(ob).append(<span class="hljs-string">&quot;,&quot;</span>);<br>               &#125;<br><br>               msg = msg + sb.substring(<span class="hljs-number">0</span>, sb.length() - <span class="hljs-number">1</span>);<br>            &#125;<br>         &#125;<br><br>         <span class="hljs-keyword">if</span> (Strings.isNullOrEmpty(username)) &#123;<br>            username = <span class="hljs-string">&quot;access.log.system.57.event&quot;</span>;<br>         &#125;<br><br>         LogAdder.add(username, -<span class="hljs-number">1</span>, req.getRemoteHost(), logEvent, msg, <span class="hljs-literal">false</span>, <span class="hljs-number">3</span>);<br>         <span class="hljs-keyword">throw</span> var14;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">logining</span><span class="hljs-params">(HttpServletRequest req, String username, String password, String times, String hash, String logEvent, String logDesct)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>      <span class="hljs-type">JsonObj</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br><br>      JsonObj user;<br>      <span class="hljs-keyword">try</span> &#123;<br>         user = <span class="hljs-built_in">this</span>.login(req, username, password, <span class="hljs-string">&quot;&quot;</span>, times);<br>      &#125; <span class="hljs-keyword">catch</span> (Exception var17) &#123;<br>         verificationCodeMap.invalidate(hash);<br>         <span class="hljs-keyword">if</span> (var17 <span class="hljs-keyword">instanceof</span> AppException) &#123;<br>            <span class="hljs-keyword">throw</span> var17;<br>         &#125;<br><br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(var17.getMessage());<br>      &#125;<br><br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Integer)user.get(<span class="hljs-string">&quot;userId&quot;</span>);<br>      <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> (User)<span class="hljs-built_in">this</span>.userService.queryById(userId);<br>      <span class="hljs-keyword">if</span> (user1 == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;system.common.error.illegalLogin&quot;</span>, <span class="hljs-string">&quot;system.common.error.illegalLogin&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-type">Integer</span> <span class="hljs-variable">roleId</span> <span class="hljs-operator">=</span> user1.getRoleId();<br>         <span class="hljs-type">String</span> <span class="hljs-variable">sid</span> <span class="hljs-operator">=</span> (String)IdentitySupplier.userIdToSessionId.supplyWith(userId);<br>         token.put(<span class="hljs-string">&quot;token&quot;</span>, sid);<br>         verificationCodeMap.invalidate(hash);<br>         <span class="hljs-keyword">if</span> (SysConfig.DEFAULT.getAsLong(<span class="hljs-string">&quot;last_modify_pwd_&quot;</span> + userId, <span class="hljs-number">0L</span>) == <span class="hljs-number">0L</span>) &#123;<br>            SysConfig.DEFAULT.set(<span class="hljs-string">&quot;last_modify_pwd_&quot;</span> + userId, System.currentTimeMillis());<br>         &#125;<br><br>         req.setAttribute(<span class="hljs-string">&quot;userId&quot;</span>, userId);<br>         LogAdder.add(user1.getUsername(), userId, req.getRemoteHost(), logEvent, logDesct, <span class="hljs-literal">true</span>, <span class="hljs-number">3</span>);<br>         <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT.getAsInt(SysSetAction.SetItem.timeout_exit.name(), <span class="hljs-number">30</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">k_currLoginClient</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;currLoginClient&quot;</span>;<br>         <span class="hljs-type">UserSessionManager</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> UserSessionManagerFactory.getInstance();<br>         ((Set)IdentitySupplier.sameUserSessionIdsByUid.supplyWith(userId)).forEach((otherSid) -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;invalid other sid &#x27;&#123;&#125;&#x27; with same uid &#x27;&#123;&#125;&#x27;&quot;</span>, otherSid, userId);<br>            instance.invalidateSession(otherSid);<br>         &#125;);<br>         instance.initailizeSession(() -&gt; &#123;<br>            <span class="hljs-keyword">return</span> sid;<br>         &#125;, (<span class="hljs-type">long</span>)timeout, TimeUnit.MINUTES);<br>         instance.putIntoSession(sid, <span class="hljs-string">&quot;user&quot;</span>, user1);<br>         instance.putIntoSession(sid, k_currLoginClient, req.getRemoteHost());<br>         <span class="hljs-keyword">return</span> token;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">loginByTwoFactor</span><span class="hljs-params">(HttpServletRequest request, String username, String password, String dynamic, String times, String hash)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">logEvent</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;access.log.system.55.event&quot;</span>;<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.checkCode(dynamic, times, username)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.error.failiedCode&quot;</span>, <span class="hljs-string">&quot;user.login.error.failiedCode&quot;</span>);<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.logining(request, username, password, times, hash, logEvent, <span class="hljs-string">&quot;access.log.system.55.desct2&quot;</span>);<br>         &#125;<br>      &#125; <span class="hljs-keyword">catch</span> (Exception var10) &#123;<br>         <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> var10 <span class="hljs-keyword">instanceof</span> AppException ? var10.getMessage() : <span class="hljs-string">&quot;access.log.system.56.desct&quot;</span>;<br>         <span class="hljs-keyword">if</span> (Strings.isNullOrEmpty(username)) &#123;<br>            username = <span class="hljs-string">&quot;access.log.system.57.event&quot;</span>;<br>         &#125;<br><br>         LogAdder.add(username, -<span class="hljs-number">1</span>, request.getRemoteHost(), logEvent, msg, <span class="hljs-literal">false</span>, <span class="hljs-number">3</span>);<br>         <span class="hljs-keyword">throw</span> var10;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkCode</span><span class="hljs-params">(String code, String times, String username)</span> &#123;<br>      <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>      Validate.notEmpty(code, <span class="hljs-string">&quot;user.login.error.codeEmpty&quot;</span>);<br>      <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>      user.setUsername(username);<br>      user = (User)<span class="hljs-built_in">this</span>.userService.queryOne(user);<br>      Validate.notNull(user, <span class="hljs-string">&quot;user.login.error.notExist&quot;</span>);<br>      <span class="hljs-type">File</span> <span class="hljs-variable">seed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> (Role)<span class="hljs-built_in">this</span>.roleService.queryById(user.getRoleId());<br>      <span class="hljs-keyword">if</span> (role.getName().contains(CurrentLocale.getMessage(<span class="hljs-string">&quot;role.admin&quot;</span>))) &#123;<br>         seed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(Constant.FEITIANCHENGXIN_DIR, <span class="hljs-string">&quot;seed.txt&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (role.getName().contains(CurrentLocale.getMessage(<span class="hljs-string">&quot;role.operator&quot;</span>))) &#123;<br>         seed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(Constant.FEITIANCHENGXIN_DIR, <span class="hljs-string">&quot;seed_oper.txt&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (role.getName().contains(CurrentLocale.getMessage(<span class="hljs-string">&quot;role.auditor&quot;</span>))) &#123;<br>         seed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(Constant.FEITIANCHENGXIN_DIR, <span class="hljs-string">&quot;seed_auditor.txt&quot;</span>);<br>      &#125;<br><br>      <span class="hljs-keyword">if</span> (seed != <span class="hljs-literal">null</span> &amp;&amp; seed.exists()) &#123;<br>         <span class="hljs-keyword">try</span> &#123;<br>            code = UserHelper.getInputPassword(username, code, times);<br>            FeitianchengxinCode.load();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">validate</span> <span class="hljs-operator">=</span> FeitianchengxinCode.validate(seed.getAbsolutePath(), code);<br>            <span class="hljs-keyword">if</span> (validate == <span class="hljs-number">0</span>) &#123;<br>               flag = <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> flag;<br>         &#125; <span class="hljs-keyword">catch</span> (Exception var9) &#123;<br>            log.error(var9.getMessage());<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;动态口令验证错误&quot;</span>, <span class="hljs-string">&quot;user.login.error.verifyError&quot;</span>);<br>         &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;miss seed file !&quot;</span>);<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;auth/tokens&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getTokens</span><span class="hljs-params">(HttpServletRequest req)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      UserSessionManagerFactory.getInstance().touchSession(IdentitySupplier.sessionIdFromRequest.supplyWith(req));<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;auth/tokens&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.DELETE&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">deleteTokens</span><span class="hljs-params">(HttpServletRequest req)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>         <span class="hljs-type">UserSessionManager</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> UserSessionManagerFactory.getInstance();<br>         <span class="hljs-type">String</span> <span class="hljs-variable">sid</span> <span class="hljs-operator">=</span> (String)IdentitySupplier.sessionIdFromRequest.supplyWith(req);<br>         log.warn(<span class="hljs-string">&quot;request delete sid:&#123;&#125;&quot;</span>, sid);<br>         <span class="hljs-keyword">if</span> (instance.touchSession(sid)) &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (User)JSON.parse(instance.getFromSession(sid, <span class="hljs-string">&quot;user&quot;</span>), User.class);<br>            <span class="hljs-keyword">if</span> (u != <span class="hljs-literal">null</span>) &#123;<br>               LogAdder.add(u.getUsername(), u.getId(), req.getRemoteAddr(), <span class="hljs-string">&quot;access.log.system.58.event&quot;</span>, <span class="hljs-string">&quot;access.log.system.58.desct&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">3</span>);<br>            &#125;<br><br>            instance.invalidateSession(sid);<br>         &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@IgnoreTokenRestful</span><br>   <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">      value = &#123;&quot;auth/captcha&quot;&#125;,</span><br><span class="hljs-meta">      method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">verificationCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">JsonObj</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br>      <span class="hljs-type">boolean</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT.getAsInt(SysSetAction.SetItem.verification_code.name(), <span class="hljs-number">1</span>) == <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">if</span> (!ProductUtil.isSeed() &amp;&amp; code) &#123;<br>         obj.put(<span class="hljs-string">&quot;has_captcha&quot;</span>, <span class="hljs-literal">true</span>);<br>         <span class="hljs-type">String</span> <span class="hljs-variable">uuid</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>         obj.put(<span class="hljs-string">&quot;hash&quot;</span>, uuid);<br>         Object[] info = VerificationCodeUtils.generate();<br>         <span class="hljs-type">BASE64Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BASE64Encoder</span>();<br>         obj.put(<span class="hljs-string">&quot;base64&quot;</span>, encoder.encode((<span class="hljs-type">byte</span>[])((<span class="hljs-type">byte</span>[])info[<span class="hljs-number">1</span>])));<br>         verificationCodeMap.put(uuid, info[<span class="hljs-number">0</span>].toString());<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         obj.put(<span class="hljs-string">&quot;has_captcha&quot;</span>, <span class="hljs-literal">false</span>);<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> obj;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> JsonObj <span class="hljs-title function_">login</span><span class="hljs-params">(HttpServletRequest req, <span class="hljs-meta">@NotNull(message = &quot;oval.verify.normal.msg4-1&quot;)</span> String username, <span class="hljs-meta">@NotNull(message = &quot;oval.verify.normal.msg4-1&quot;)</span> String password, <span class="hljs-meta">@NotNull(message = &quot;oval.verify.normal.msg4-1&quot;)</span> String vcode, <span class="hljs-meta">@NotNull(message = &quot;oval.verify.normal.msg4-1&quot;)</span> String times)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-type">SysConfig</span> <span class="hljs-variable">sysConfig</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT;<br>      <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(username);<br>      u = (User)<span class="hljs-built_in">this</span>.userService.queryOne(u);<br>      <span class="hljs-keyword">if</span> (u == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.error.hasError&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> u.getId();<br>         <span class="hljs-type">int</span> <span class="hljs-variable">lockWay</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT.getAsInt(SysSetAction.SetItem.login_lock_way.name(), ProductUtil.isSecret() ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);<br>         <span class="hljs-type">Long</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT.getAsLong(SysSetAction.SetItem.max_time_loginfailed.name(), <span class="hljs-number">5L</span>) * <span class="hljs-number">60L</span>;<br>         <span class="hljs-keyword">if</span> (u.getDisabled() == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.error.disableLogin&quot;</span>)).setParams(username);<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (lockWay == <span class="hljs-number">1</span>) &#123;<br>               <span class="hljs-type">Long</span> <span class="hljs-variable">lockTime</span> <span class="hljs-operator">=</span> u.getLockTime();<br>               <span class="hljs-keyword">if</span> (lockTime != <span class="hljs-literal">null</span>) &#123;<br>                  <span class="hljs-type">long</span> <span class="hljs-variable">leftTime</span> <span class="hljs-operator">=</span> (System.currentTimeMillis() - lockTime) / <span class="hljs-number">1000L</span> - timeout;<br>                  <span class="hljs-keyword">if</span> (leftTime &lt;= <span class="hljs-number">0L</span>) &#123;<br>                     <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.error.lockUser&quot;</span>)).setParams(Math.abs(leftTime));<br>                  &#125;<br>               &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (lockWay == <span class="hljs-number">2</span>) &#123;<br>               <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.redisTemplate.boundHashOps(<span class="hljs-string">&quot;ipaddrLock&quot;</span>).entries();<br>               <span class="hljs-type">Long</span> <span class="hljs-variable">lockTime</span> <span class="hljs-operator">=</span> map == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : (Long)map.get(req.getRemoteAddr());<br>               <span class="hljs-keyword">if</span> (lockTime != <span class="hljs-literal">null</span>) &#123;<br>                  <span class="hljs-type">long</span> <span class="hljs-variable">leftTime</span> <span class="hljs-operator">=</span> (System.currentTimeMillis() - lockTime) / <span class="hljs-number">1000L</span> - timeout;<br>                  <span class="hljs-keyword">if</span> (leftTime &lt;= <span class="hljs-number">0L</span>) &#123;<br>                     <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(<span class="hljs-string">&quot;user.login.error.lockIp&quot;</span>)).setParams(Math.abs(leftTime));<br>                  &#125;<br><br>                  <span class="hljs-built_in">this</span>.setRedisIpaddr(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>());<br>               &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (!UserHelper.decryptGeneratePwd(username, password, times).equals(u.getPassword())) &#123;<br>               <span class="hljs-keyword">if</span> (lockWay != <span class="hljs-number">0</span>) &#123;<br>                  <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> WebContextUtil.getObjInSession(req, <span class="hljs-string">&quot;lock_times&quot;</span>);<br>                  <span class="hljs-type">int</span> <span class="hljs-variable">errorTimes</span> <span class="hljs-operator">=</span> obj == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : Integer.parseInt(obj.toString());<br>                  ++errorTimes;<br>                  <span class="hljs-keyword">if</span> (errorTimes == sysConfig.getAsInt(SysSetAction.SetItem.max_num_loginfailed.name(), <span class="hljs-number">5</span>)) &#123;<br>                     <span class="hljs-type">String</span> <span class="hljs-variable">errorTips</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;用户名或者密码错误，&quot;</span>;<br>                     <span class="hljs-type">String</span> <span class="hljs-variable">msgCode</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user.login.error.hasError&quot;</span>;<br>                     <span class="hljs-type">Long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>                     u.setLockTime(currentTime);<br>                     <span class="hljs-keyword">if</span> (lockWay == <span class="hljs-number">1</span>) &#123;<br>                        errorTips = errorTips + <span class="hljs-string">&quot;该账户已被锁定！&quot;</span>;<br>                        msgCode = <span class="hljs-string">&quot;user.login.error.lockUser2&quot;</span>;<br>                     &#125; <span class="hljs-keyword">else</span> &#123;<br>                        errorTips = errorTips + <span class="hljs-string">&quot;该地址已被锁定！&quot;</span>;<br>                        msgCode = <span class="hljs-string">&quot;user.login.error.lockIp2&quot;</span>;<br>                        <span class="hljs-type">Map</span> <span class="hljs-variable">newHash</span> <span class="hljs-operator">=</span> Maps.newHashMap();<br>                        newHash.put(req.getRemoteAddr(), currentTime);<br>                        <span class="hljs-built_in">this</span>.setRedisIpaddr(newHash);<br>                     &#125;<br><br>                     <span class="hljs-built_in">this</span>.userService.updateById(userId, u);<br>                     req.getSession().setAttribute(<span class="hljs-string">&quot;lock_times&quot;</span>, <span class="hljs-number">0</span>);<br>                     <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppException</span>(msgCode, msgCode);<br>                  &#125;<br><br>                  req.getSession().setAttribute(<span class="hljs-string">&quot;lock_times&quot;</span>, errorTimes);<br>               &#125;<br><br>               <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginException</span>(<span class="hljs-string">&quot;user.login.error.hasError&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-built_in">this</span>.updateConfig(u);<br>               req.getSession().removeAttribute(<span class="hljs-string">&quot;lock_times&quot;</span>);<br>               u.setLastLoginTime(System.currentTimeMillis());<br>               u.setLockTime((Long)<span class="hljs-literal">null</span>);<br>               u.setLastLoginClient(req.getRemoteAddr());<br>               <span class="hljs-built_in">this</span>.userService.updateById(userId, u);<br>               <span class="hljs-type">JsonObj</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonObj</span>(<span class="hljs-literal">true</span>);<br><br>               <span class="hljs-keyword">try</span> &#123;<br>                  obj.put(<span class="hljs-string">&quot;userId&quot;</span>, userId);<br>               &#125; <span class="hljs-keyword">catch</span> (Exception var17) &#123;<br>                  log.error(<span class="hljs-string">&quot;&quot;</span>, var17);<br>               &#125;<br><br>               <span class="hljs-keyword">return</span> obj;<br>            &#125;<br>         &#125;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateConfig</span><span class="hljs-params">(User user)</span> &#123;<br>      <span class="hljs-type">Integer</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> user.getId();<br>      <span class="hljs-keyword">if</span> (userId == <span class="hljs-number">1</span> &amp;&amp; user.getLastLoginTime() == <span class="hljs-literal">null</span>) &#123;<br>         SysConfig.INFO.set(<span class="hljs-string">&quot;password_modify_AD&quot;</span>, <span class="hljs-number">1</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (userId == <span class="hljs-number">2</span> &amp;&amp; user.getLastLoginTime() == <span class="hljs-literal">null</span>) &#123;<br>         SysConfig.INFO.set(<span class="hljs-string">&quot;password_modify_AU&quot;</span>, <span class="hljs-number">1</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (userId == <span class="hljs-number">3</span> &amp;&amp; user.getLastLoginTime() == <span class="hljs-literal">null</span>) &#123;<br>         SysConfig.INFO.set(<span class="hljs-string">&quot;password_modify_OP&quot;</span>, <span class="hljs-number">1</span>);<br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRedisIpaddr</span><span class="hljs-params">(Map newHash)</span> &#123;<br>      <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.redisTemplate.boundHashOps(<span class="hljs-string">&quot;ipaddrLock&quot;</span>).entries();<br>      <span class="hljs-type">Long</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> SysConfig.DEFAULT.getAsLong(SysSetAction.SetItem.max_time_loginfailed.name(), <span class="hljs-number">5L</span>) * <span class="hljs-number">60L</span>;<br>      map.forEach((k, v) -&gt; &#123;<br>         <span class="hljs-type">long</span> <span class="hljs-variable">leftTime</span> <span class="hljs-operator">=</span> timeout - (System.currentTimeMillis() - v) / <span class="hljs-number">1000L</span>;<br>         <span class="hljs-keyword">if</span> (leftTime &gt; <span class="hljs-number">0L</span>) &#123;<br>            newHash.put(k, v);<br>         &#125;<br><br>      &#125;);<br>      <span class="hljs-keyword">if</span> (newHash.size() &gt; <span class="hljs-number">0</span>) &#123;<br>         <span class="hljs-built_in">this</span>.redisTemplate.boundHashOps(<span class="hljs-string">&quot;ipaddrLock&quot;</span>).putAll(newHash);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-built_in">this</span>.redisTemplate.delete(<span class="hljs-string">&quot;ipaddrLock&quot;</span>);<br>      &#125;<br><br>   &#125;<br><br>   <span class="hljs-keyword">static</span> &#123;<br>      verificationCodeMap = CacheBuilder.newBuilder().softValues().maximumSize(<span class="hljs-number">20L</span>).expireAfterAccess(<span class="hljs-number">3L</span>, TimeUnit.MINUTES).build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>() &#123;<br>         <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(String str)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>         &#125;<br>      &#125;);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="深信服"><a href="#深信服" class="headerlink" title="深信服"></a>深信服</h1><h2 id="AF（下一代防火墙）"><a href="#AF（下一代防火墙）" class="headerlink" title="AF（下一代防火墙）"></a>AF（下一代防火墙）</h2><p>和上面的方法接近，我用PVE，使用备份形式能够实现多设备同网关，然后再申请一个测试授权。</p>
<p>经测试，同一镜像文件下8095、8075，如果管理网口(第一个网口)的MAC地址一样，则网关ID一样。</p>
<p>授权相关验证程序拿到，但没时间做逆向分析，且存在大量的so库调用。</p>
<p>具体过程不便透露</p>
<h2 id="AC（上网-全网-行为管理系统）"><a href="#AC（上网-全网-行为管理系统）" class="headerlink" title="AC（上网&#x2F;全网 行为管理系统）"></a>AC（上网&#x2F;全网 行为管理系统）</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gsls200808/article/details/121795415">底层密码为<code>当前密码</code>sangfornetwork</a></p>
</blockquote>
<hr>
<p>未完待续</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%8A%80%E6%9C%AF-%E8%BD%AF%E4%BB%B6/" class="category-chain-item">技术/软件</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AE%B0%E5%BD%95/" class="print-no-link">#记录</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2001012/" title="TrueNAS-25.04.2.1允许密码登录ssh">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">TrueNAS-25.04.2.1允许密码登录ssh</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2001009/" title="H5-9光猫的一些配置">
                        <span class="hidden-mobile">H5-9光猫的一些配置</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <!--<i class="iconfont icon-love"></i>--> | <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> || <a href="//www.ucu520.top" target="_blank" rel="nofollow noopener"><span>开心ucu</span></a> | <a href="https://github.com/itsmeucu/itsmeucu" target="_blank" rel="nofollow noopener"><span>GitHub</span></a>  
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
